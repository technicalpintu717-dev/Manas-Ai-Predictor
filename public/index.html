<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MANAS AI PREDICTOR</title>
<style>
  body,html{margin:0;height:100%;overflow:hidden;background:#0b0f17;color:#e6eef6;font-family:Arial,Helvetica,sans-serif;}
  #particles-js{position:fixed;width:100%;height:100%;top:0;left:0;z-index:-1;background:#0b0f17;}
  .wrap{max-width:960px;margin:20px auto;padding:20px;position:relative;z-index:1}
  .card{background:#111827;padding:14px;border-radius:10px;margin-bottom:14px;box-shadow:0 0 15px rgba(0,240,255,0.15);}
  textarea,input{width:100%;padding:8px;border-radius:6px;border:1px solid #333;background:#0f1722;color:#e6eef6}
  button{margin-top:8px;padding:8px 12px;border-radius:6px;border:none;cursor:pointer;font-weight:bold}
  button.primary{background:linear-gradient(90deg,#00f0ff,#a64dff);color:#04121a;box-shadow:0 0 10px rgba(0,240,255,0.5);}
  .chip{display:inline-block;padding:6px 10px;border-radius:6px;margin:3px;font-weight:bold}
  .chip.big{background:#1e293b;color:#ffb199}
  .chip.small{background:#1e293b;color:#9aefff}
  .result{font-size:22px;font-weight:700;margin:8px 0}
  h2{text-align:center;text-shadow:0 0 10px #00eaff}
</style>
</head>
<body>
<div id="particles-js"></div>

<!-- Login Gate -->
<div id="loginBox" class="wrap">
  <div class="card">
    <h2>Enter Access Key</h2>
    <input type="text" id="keyInput" placeholder="Enter your key">
    <button id="btnLogin" class="primary">Login</button>
    <div id="loginMsg" style="color:#ff8080;margin-top:8px"></div>
  </div>
</div>

<!-- Predictor UI -->
<div id="predictorBox" class="wrap" style="display:none;">
  <h2>MANAS AI PREDICTOR</h2>
  <div class="card">
    <label>ENTER YOUR DIGITS </label>
    <textarea id="historyInput" rows="3" placeholder="Example 584372"></textarea>
    <button id="btnPredict" class="primary">Predict Next</button>
    <div id="historyChips"></div>
  </div>
  <div class="card">
    <div>Next Prediction:</div>
    <div class="result" id="predictionBand">—</div>
    <div>Confidence: <span id="confidence">—</span></div>
    <div>Number:</div>
    <div id="topDigits"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script>
// Particle background
particlesJS("particles-js",{particles:{number:{value:90,density:{enable:true,value_area:900}},color:{value:["#00f0ff","#a64dff"]},shape:{type:["circle","triangle"],stroke:{width:0,color:"#000"}},opacity:{value:0.6,random:true,anim:{enable:true,speed:1,opacity_min:0.3,sync:false}},size:{value:4,random:true,anim:{enable:true,speed:2,size_min:1,sync:false}},line_linked:{enable:true,distance:140,color:"#9d4dff",opacity:0.6,width:1.2},move:{enable:true,speed:2.2,random:true,out_mode:"out"}},interactivity:{detect_on:"canvas",events:{onhover:{enable:true,mode:"grab"},onclick:{enable:true,mode:"push"},resize:true},modes:{grab:{distance:160,line_linked:{opacity:1}},bubble:{distance:200,size:8,duration:2,opacity:0.8,speed:3},repulse:{distance:120,duration:0.4}}},retina_detect:true});

// Device ID
function getDeviceId(){
  let id=localStorage.getItem("deviceId");
  if(!id){id=crypto.randomUUID();localStorage.setItem("deviceId",id);}
  return id;
}

// Login check
document.getElementById("btnLogin").onclick=()=>{
  const key=document.getElementById("keyInput").value.trim();
  if(!key) return;
  fetch("/api/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key,deviceId:getDeviceId()})})
    .then(r=>r.json()).then(d=>{
      if(d.success){
        document.getElementById("loginBox").style.display="none";
        document.getElementById("predictorBox").style.display="block";
      }else{
        document.getElementById("loginMsg").innerText=d.error||"Login failed";
      }
    });
};

// Predictor logic (same as आपका code)
function toDigitsArray(text){if(!text)return[];text=text.trim();if(/[,\s]/.test(text)){return text.split(/[,\s]+/).map(s=>s.trim()).filter(Boolean).map(Number).filter(n=>n>=0&&n<=9);}return text.split("").map(Number).filter(n=>n>=0&&n<=9);}
function isBig(d){return d>=5;}function bandOf(d){return d>=5?'Big':'Small';}
function StreakFlow(h){if(!h.length)return{name:'StreakFlow',score:0,meta:{}};const fb=bandOf(h[0]);let streak=1;for(let i=1;i<h.length;i++){if(bandOf(h[i])===fb)streak++;else break;}const rev=Math.min(0.9,0.25*streak+0.1);return{name:'StreakFlow',score:(fb==='Big'?-1:1)*rev,meta:{}};}
function DoubleRepeatBreak(h){if(h.length<2)return{name:'DoubleRepeatBreak',score:0,meta:{}};if(h[0]===h[1])return{name:'DoubleRepeatBreak',score:(bandOf(h[0])==='Big'?-1:1)*0.7,meta:{}};return{name:'DoubleRepeatBreak',score:0,meta:{}};}
function ParityFlip(h){if(!h.length)return{name:'ParityFlip',score:0,meta:{}};const l=h[0];if(l%2===1&&isBig(l))return{name:'ParityFlip',score:-0.6,meta:{digits:[2,4,0]}};return{name:'ParityFlip',score:0.1,meta:{}};}
function DigitBandBias(h){const win=h.slice(0,30);let big=0,small=0;win.forEach(d=>{if(isBig(d))big++;else small++;});const tot=win.length||1;const bp=big/tot,sp=small/tot;if(bp>0.6)return{name:'DigitBandBias',score:-0.6,meta:{}};if(sp>0.6)return{name:'DigitBandBias',score:0.6,meta:{}};return{name:'DigitBandBias',score:0,meta:{}};}
function FlowMemory(h){const win=h.slice(0,20);const freq=Array(10).fill(0);win.forEach(d=>freq[d]++);const max=Math.max(...freq);if(max===0)return{name:'FlowMemory',score:0,meta:{}};const peaks=[];freq.forEach((v,i)=>{if(v===max)peaks.push(i);});return{name:'FlowMemory',score:0.3,meta:{peaks}};}
function computePrediction(h){const logics=[StreakFlow,DoubleRepeatBreak,ParityFlip,DigitBandBias,FlowMemory];let total=0;const res=[];logics.forEach(fn=>{const o=fn(h);res.push(o);total+=o.score;});const prefer=total>=0?'Small':'Big';const conf=Math.min(95,Math.round(Math.abs(total)*100));const digitScores=Array(10).fill(0);const fm=res.find(r=>r.name==='FlowMemory');if(fm?.meta?.peaks)fm.meta.peaks.forEach(d=>digitScores[d]+=1.2);const pf=res.find(r=>r.name==='ParityFlip');if(pf?.meta?.digits)pf.meta.digits.forEach(d=>digitScores[d]+=1);for(let d=0;d<10;d++){if(prefer==='Big'&&isBig(d))digitScores[d]+=0.8;if(prefer==='Small'&&!isBig(d))digitScores[d]+=0.8;}const top=[...digitScores.map((s,d)=>({d,s}))].sort((a,b)=>b.s-a.s).slice(0,3).map(x=>x.d);return{band:prefer,conf,top};}
document.getElementById("btnPredict").onclick=()=>{const arr=toDigitsArray(document.getElementById("historyInput").value);if(!arr.length){alert('History खाली है');return;}document.getElementById("historyChips").innerHTML=arr.map(d=>`<span class="chip ${isBig(d)?'big':'small'}">${d}</span>`).join('');const r=computePrediction(arr);document.getElementById("predictionBand").textContent=r.band;document.getElementById("confidence").textContent=r.conf+'%';document.getElementById("topDigits").innerHTML=r.top.map(d=>`<span class="chip ${isBig(d)?'big':'small'}">${d}</span>`).join('');};
</script>
</body>
</html>
